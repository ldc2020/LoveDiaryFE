<!--pages/plan/movie/movie.wxml-->
<view class="movie-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-left" bindtap="goBack">
      <text class="iconfont icon-back"></text>
    </view>
    <text class="page-title">ç”µå½±è®¡åˆ’</text>
    <view class="header-right">
      <!-- ç§»é™¤åŸæœ‰çš„æ·»åŠ æŒ‰é’® -->
    </view>
  </view>

  <!-- ç”µå½±åˆ—è¡¨ -->
  <scroll-view class="movie-content" scroll-y="true" enhanced="true">
    <view class="movie-list">
      <view class="movie-item" wx:for="{{moviePlans}}" wx:key="_id" 
            bindtap="showMovieDetail" data-plan="{{item}}">
        <view class="movie-content-row">
          <view class="movie-main-info">
            <text class="movie-title">{{item.movieName}}</text>
            <view class="movie-sub-info">
              <text class="movie-release-time">{{item.releaseTime || 'ä¸Šæ˜ æ—¶é—´æœªçŸ¥'}}</text>
              <text class="movie-rating" wx:if="{{item.rating}}">â­ {{item.rating}}</text>
            </view>
          </view>
          <view class="movie-status {{item.watched ? 'watched' : 'unwatched'}}">
            <text>{{item.watched ? 'å·²çœ‹' : 'æœªçœ‹'}}</text>
          </view>
        </view>
      </view>
    </view>
    
    <view class="empty-state" wx:if="{{moviePlans.length === 0}}">
      <text class="empty-icon">ğŸ¬</text>
      <text class="empty-text">æš‚æ— ç”µå½±è®¡åˆ’</text>
      <text class="empty-tip">ç‚¹å‡»å³ä¸‹è§’æ·»åŠ æ–°çš„ç”µå½±è®¡åˆ’</text>
    </view>
  </scroll-view>

  <!-- æ·»åŠ ç”µå½±å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showAddModal}}" bindtap="hideAddModal">
    <view class="add-modal add-modal-wide" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">æ·»åŠ ç”µå½±è®¡åˆ’</text>
        <view class="modal-close" bindtap="hideAddModal">
          <text class="close-icon">Ã—</text>
        </view>
      </view>
      
      <view class="modal-content">
        <view class="search-section">
          <view class="search-input-wrap">
            <input 
              class="search-input" 
              placeholder="è¯·è¾“å…¥ç”µå½±åç§°æœç´¢"
              value="{{searchKeyword}}"
              bindinput="onSearchInput"
              bindconfirm="searchMovie"
              disabled="{{isSearching}}"
            />
            <view class="search-btn {{isSearching ? 'searching' : ''}}" bindtap="searchMovie">
              <text class="search-icon" wx:if="{{!isSearching}}">ğŸ”</text>
              <text class="search-loading" wx:if="{{isSearching}}">â³</text>
              <text class="search-text">{{isSearching ? 'æœç´¢ä¸­...' : 'æœç´¢'}}</text>
            </view>
          </view>
          
          <!-- æœç´¢åŠ è½½æç¤º -->
          <view class="search-loading-tip" wx:if="{{isSearching}}">
            <text class="loading-text">æ­£åœ¨æœç´¢ç”µå½±ä¿¡æ¯ï¼Œè¯·ç¨å€™...</text>
          </view>
        </view>
        
        <view class="movie-result" wx:if="{{movieInfo}}">
          <view class="result-content">
            <view class="result-poster" wx:if="{{movieInfo.poster}}">
              <image class="poster-image" src="{{movieInfo.poster}}" mode="aspectFit" lazy-load="true" />
            </view>
            <view class="result-details">
              <view class="result-title">{{movieInfo.title}}</view>
              <view class="result-info">å¯¼æ¼”ï¼š{{movieInfo.director}}</view>
              <view class="result-info">ä¸»æ¼”ï¼š{{movieInfo.actors}}</view>
              <view class="result-info">ä¸Šæ˜ æ—¶é—´ï¼š{{movieInfo.year}}</view>
              <view class="result-info">ç±»å‹ï¼š{{movieInfo.genre}}</view>
              <view class="result-info">è¯„åˆ†ï¼š{{movieInfo.rating}}</view>
              <view class="result-info">æ—¶é•¿ï¼š{{movieInfo.duration}}</view>
            </view>
          </view>
          <view class="result-summary">{{movieInfo.plot}}</view>
        </view>
        
        <view class="modal-actions">
          <button class="cancel-btn" bindtap="hideAddModal">å–æ¶ˆ</button>
          <button class="confirm-btn" bindtap="addMoviePlan" disabled="{{!movieInfo || isAdding}}" loading="{{isAdding}}">{{isAdding ? 'æ·»åŠ ä¸­...' : 'æ·»åŠ '}}</button>
        </view>
      </view>
    </view>
  </view>


  <!-- ç”µå½±è¯¦æƒ…å¼¹çª— -->
  <view class="detail-modal" wx:if="{{showDetailModal}}" bindtap="hideDetailModal">
    <view class="detail-modal-content" catchtap="stopPropagation">
      <view class="detail-header">
        <text class="detail-title">ç”µå½±è¯¦æƒ…</text>
        <text class="detail-close" bindtap="hideDetailModal">Ã—</text>
      </view>
      <view class="detail-body" wx:if="{{selectedMovie}}">
        <view class="detail-poster-section" wx:if="{{selectedMovie.poster}}">
          <image class="detail-poster-image" src="{{selectedMovie.poster}}" mode="aspectFit" lazy-load="true" />
        </view>
        <view class="detail-item">
          <text class="detail-label">ç”µå½±åç§°ï¼š</text>
          <text class="detail-value">{{selectedMovie.movieName}}</text>
        </view>
        <view class="detail-item" wx:if="{{selectedMovie.releaseTime}}">
          <text class="detail-label">ä¸Šæ˜ æ—¶é—´ï¼š</text>
          <text class="detail-value">{{selectedMovie.releaseTime}}</text>
        </view>
        <view class="detail-item" wx:if="{{selectedMovie.rating}}">
          <text class="detail-label">è¯„åˆ†ï¼š</text>
          <text class="detail-value detail-rating">{{selectedMovie.rating}}</text>
        </view>
        <view class="detail-item" wx:if="{{selectedMovie.duration}}">
          <text class="detail-label">æ—¶é•¿ï¼š</text>
          <text class="detail-value">{{selectedMovie.duration}}</text>
        </view>
        <view class="detail-item" wx:if="{{selectedMovie.genre}}">
          <text class="detail-label">ç±»å‹ï¼š</text>
          <text class="detail-value">{{selectedMovie.genre}}</text>
        </view>
        <view class="detail-item" wx:if="{{selectedMovie.director}}">
          <text class="detail-label">å¯¼æ¼”ï¼š</text>
          <text class="detail-value">{{selectedMovie.director}}</text>
        </view>
        <view class="detail-item" wx:if="{{selectedMovie.actors}}">
          <text class="detail-label">ä¸»æ¼”ï¼š</text>
          <text class="detail-value">{{selectedMovie.actors}}</text>
        </view>
        <view class="detail-item" wx:if="{{selectedMovie.movieInfo}}">
          <text class="detail-label">ç”µå½±ç®€ä»‹ï¼š</text>
          <text class="detail-value detail-summary">{{selectedMovie.movieInfo}}</text>
        </view>
        <view class="detail-item" wx:if="{{selectedMovie.summary}}">
          <text class="detail-label">å‰§æƒ…ç®€ä»‹ï¼š</text>
          <text class="detail-value detail-summary">{{selectedMovie.summary}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">è§‚çœ‹çŠ¶æ€ï¼š</text>
          <text class="detail-value {{selectedMovie.watched ? 'status-watched' : 'status-unwatched'}}">{{selectedMovie.watched ? 'å·²è§‚çœ‹' : 'æœªè§‚çœ‹'}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æ·»åŠ æ—¶é—´ï¼š</text>
          <text class="detail-value">{{selectedMovie.createTime}}</text>
        </view>
      </view>
      <view class="detail-actions">
        <button class="detail-btn secondary" bindtap="hideDetailModal">å…³é—­</button>
        <button class="detail-btn primary" bindtap="toggleWatchStatus">{{selectedMovie.watched ? 'æ ‡è®°æœªçœ‹' : 'æ ‡è®°å·²çœ‹'}}</button>
        <button class="detail-btn danger" bindtap="deleteMoviePlan" loading="{{isDeleting}}">{{isDeleting ? 'åˆ é™¤ä¸­...' : 'åˆ é™¤'}}</button>
      </view>
    </view>
  </view>

  <!-- æ‚¬æµ®æ·»åŠ æŒ‰é’® -->
  <view class="floating-add-btn" bindtap="showAddModal">
    <text class="add-icon">+</text>
  </view>

  <debug-panel></debug-panel>
</view>