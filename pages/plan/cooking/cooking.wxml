<!--çƒ¹é¥ªè®¡åˆ’é¡µé¢ - æ™ºèƒ½èœè°±ç”Ÿæˆå’Œç®¡ç†-->
<view class="cooking-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <text class="page-title">ğŸ³ çƒ¹é¥ªè®¡åˆ’</text>
    <view class="smart-input-btn" bindtap="showAddRecipeModal">
      <text class="iconfont icon-add"></text>
      <text>æ™ºèƒ½æ·»åŠ </text>
    </view>
  </view>

  <!-- èœè°±åˆ—è¡¨ -->
  <view class="recipe-list">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading && recipeList.length === 0}}" class="loading-container">
      <view class="loading-spinner"></view>
      <text class="loading-text">æ­£åœ¨åŠ è½½èœè°±...</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:elif="{{!loading && recipeList.length === 0}}" class="empty-state">
      <view class="empty-icon">ğŸ½ï¸</view>
      <text class="empty-title">è¿˜æ²¡æœ‰èœè°±</text>
      <text class="empty-desc">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ ç¬¬ä¸€ä¸ªèœè°±å§</text>
    </view>

    <!-- èœè°±å¡ç‰‡åˆ—è¡¨ -->
    <view wx:else class="recipe-cards">
      <view 
        wx:for="{{recipeList}}" 
        wx:key="_id" 
        class="recipe-card"
        bindtap="onRecipeCardTap"
        data-recipe="{{item}}"
      >
        <!-- èœè°±å›¾ç‰‡ - åªæœ‰å½“å­˜åœ¨å›¾ç‰‡æ—¶æ‰æ˜¾ç¤º -->
        <view wx:if="{{item.finishedImage}}" class="card-image">
          <image 
            src="{{item.finishedImage}}"
            class="recipe-image"
            mode="aspectFill"
          />
          <!-- éš¾åº¦æ ‡ç­¾ -->
          <view class="difficulty-tag difficulty-{{item.difficulty === 'ç®€å•' ? 'easy' : item.difficulty === 'ä¸­ç­‰' ? 'medium' : 'hard'}}">
            {{item.difficulty}}
          </view>
        </view>
        
        <!-- æ— å›¾ç‰‡æ—¶çš„éš¾åº¦æ ‡ç­¾ -->
        <view wx:else class="no-image-difficulty">
          <view class="difficulty-tag-no-image difficulty-{{item.difficulty === 'ç®€å•' ? 'easy' : item.difficulty === 'ä¸­ç­‰' ? 'medium' : 'hard'}}">
            {{item.difficulty}}
          </view>
        </view>

        <!-- èœè°±ä¿¡æ¯ -->
        <view class="card-content">
          <view class="card-header">
            <text class="dish-name">{{item.dishName}}</text>
            <view class="cooking-time">
              <text class="iconfont icon-time"></text>
              <text class="time-text">{{item.cookingTime}}åˆ†é’Ÿ</text>
            </view>
          </view>
          
          <text class="description">{{item.description}}</text>
          
          <!-- æ ‡ç­¾ -->
          <view class="tags">
            <text 
              wx:for="{{item.tags}}" 
              wx:for-item="tag" 
              wx:key="*this" 
              class="tag tag-color-{{(index + 1) % 6 + 1}}"
            >
              {{tag}}
            </text>
          </view>
          
          <!-- åº•éƒ¨ä¿¡æ¯ -->
          <view class="card-footer">
            <view class="servings">
              <text class="iconfont icon-user"></text>
              <text>{{item.servings}}äººä»½</text>
            </view>
            <view class="creator">
              <text class="creator-name">{{item.creatorName}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤šæç¤º -->
    <view wx:if="{{loading && recipeList.length > 0}}" class="load-more">
      <view class="loading-spinner small"></view>
      <text>åŠ è½½ä¸­...</text>
    </view>
    
    <view wx:elif="{{!hasMore && recipeList.length > 0}}" class="no-more">
      <text>å·²æ˜¾ç¤ºå…¨éƒ¨èœè°±</text>
    </view>
  </view>
</view>

<!-- æ™ºèƒ½æ·»åŠ èœè°±å¼¹çª— -->
<view wx:if="{{showAddModal}}" class="modal-overlay" bindtap="hideAddModal">
  <view class="add-modal" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">ğŸ¤– æ™ºèƒ½æ·»åŠ èœè°±</text>
      <button class="close-btn" bindtap="hideAddModal">
      </button>
    </view>
    
    <view class="modal-content">
      <view class="input-section">
        <textarea 
          class="recipe-input"
          placeholder="{{inputPlaceholder}}"
          value="{{inputText}}"
          bindinput="onInputChange"
          maxlength="1000"
          auto-height
        />
        <view class="input-counter">
          <text>{{inputText.length}}/1000</text>
        </view>
      </view>
      
      <view class="tips">
        <view class="tip-item">
          <text class="tip-icon">ğŸ’¡</text>
          <text class="tip-text">è¾“å…¥èœåå¦‚"å®«ä¿é¸¡ä¸"ï¼ŒAIå°†è‡ªåŠ¨ç”Ÿæˆå®Œæ•´èœè°±</text>
        </view>
        <view class="tip-item">
          <text class="tip-icon">ğŸ“</text>
          <text class="tip-text">è¾“å…¥å®Œæ•´èœè°±ï¼ŒAIå°†å¸®æ‚¨æ•´ç†æ ¼å¼å’Œæ·»åŠ emoji</text>
        </view>
      </view>
    </view>
    
    <view class="modal-footer">
      <button class="cancel-btn" bindtap="hideAddModal">å–æ¶ˆ</button>
      <button 
        class="generate-btn {{isGenerating ? 'loading' : ''}}"
        bindtap="generateRecipe"
        disabled="{{isGenerating}}"
      >
        <view wx:if="{{isGenerating}}" class="btn-loading">
          <view class="loading-spinner small"></view>
          <text>AIç”Ÿæˆä¸­...</text>
        </view>
        <text wx:else>ğŸš€ æ™ºèƒ½ç”Ÿæˆ</text>
      </button>
    </view>
  </view>
</view>

<!-- èœè°±è¯¦æƒ…å¼¹çª— -->
<view wx:if="{{showDetailModal}}" class="modal-overlay" bindtap="hideDetailModal">
  <view class="detail-modal" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">{{currentRecipe.dishName}}</text>
      <button class="close-btn" bindtap="hideDetailModal">
        <text class="iconfont icon-close"></text>
      </button>
    </view>
    
    <scroll-view class="modal-content scroll-hidden" scroll-y>
      <!-- èœè°±åŸºæœ¬ä¿¡æ¯ -->
      <view class="recipe-info">
        <!-- æˆå“å›¾ç‰‡ - åªæœ‰å½“å­˜åœ¨å›¾ç‰‡æ—¶æ‰æ˜¾ç¤º -->
        <view wx:if="{{currentRecipe.finishedImage}}" class="finished-image-section">
          <view class="finished-image">
            <image 
              src="{{currentRecipe.finishedImage}}"
              class="finished-img"
              mode="aspectFill"
            />
          </view>
        </view>
        
        <!-- èœè°±æè¿° -->
        <view class="recipe-desc">
          <text wx:if="{{!isEditing}}">{{currentRecipe.description}}</text>
          <textarea 
            wx:else
            class="edit-input"
            value="{{editRecipe.description}}"
            bindinput="onEditInputChange"
            data-field="description"
            placeholder="è¯·è¾“å…¥èœè°±æè¿°"
          />
        </view>
        
        <!-- èœè°±å±æ€§ -->
        <view class="recipe-attrs">
          <view class="attr-item">
            <text class="attr-label">â±ï¸ çƒ¹é¥ªæ—¶é—´</text>
            <text wx:if="{{!isEditing}}" class="attr-value">{{currentRecipe.cookingTime}}åˆ†é’Ÿ</text>
            <input 
              wx:else
              class="edit-input small"
              type="number"
              value="{{editRecipe.cookingTime}}"
              bindinput="onEditInputChange"
              data-field="cookingTime"
            />
          </view>
          <view class="attr-item">
            <text class="attr-label">ğŸ‘¥ ä»½é‡</text>
            <text wx:if="{{!isEditing}}" class="attr-value">{{currentRecipe.servings}}äººä»½</text>
            <input 
              wx:else
              class="edit-input small"
              type="number"
              value="{{editRecipe.servings}}"
              bindinput="onEditInputChange"
              data-field="servings"
            />
          </view>
          <view class="attr-item">
            <text class="attr-label">â­ éš¾åº¦</text>
            <text wx:if="{{!isEditing}}" class="attr-value">{{currentRecipe.difficulty}}</text>
            <picker 
              wx:else
              class="edit-picker"
              range="{{['ç®€å•', 'ä¸­ç­‰', 'å›°éš¾']}}"
              value="{{editRecipe.difficulty}}"
              bindchange="onEditInputChange"
              data-field="difficulty"
            >
              <text class="picker-text">{{editRecipe.difficulty}}</text>
            </picker>
          </view>
        </view>
      </view>
      
      <!-- é£Ÿæåˆ—è¡¨ -->
      <view class="ingredients-section">
        <view class="section-header">
          <text class="section-title">ğŸ¥˜ æ‰€éœ€é£Ÿæ</text>
          <button wx:if="{{isEditing}}" class="add-btn" bindtap="addIngredient">+</button>
        </view>
        <view class="ingredients-list">
          <view 
            wx:for="{{isEditing ? editRecipe.ingredients : currentRecipe.ingredients}}" 
            wx:key="name" 
            class="ingredient-item {{isEditing ? 'editing' : ''}}"
          >
            <text class="ingredient-emoji">{{item.emoji}}</text>
            <view wx:if="{{!isEditing}}" class="ingredient-content">
              <text class="ingredient-name">{{item.name}}</text>
              <text class="ingredient-amount">{{item.amount}}</text>
            </view>
            <view wx:else class="ingredient-edit">
              <input 
                class="edit-input ingredient-name-input"
                value="{{item.name}}"
                bindinput="onIngredientChange"
                data-index="{{index}}"
                data-field="name"
                placeholder="é£Ÿæåç§°"
              />
              <input 
                class="edit-input ingredient-amount-input"
                value="{{item.amount}}"
                bindinput="onIngredientChange"
                data-index="{{index}}"
                data-field="amount"
                placeholder="ç”¨é‡"
              />
              <button 
                class="remove-btn"
                bindtap="removeIngredient"
                data-index="{{index}}"
              >Ã—</button>
            </view>
          </view>
        </view>
      </view>
      
      <!-- åˆ¶ä½œæ­¥éª¤ -->
      <view class="steps-section">
        <view class="section-header">
          <text class="section-title">ğŸ‘¨â€ğŸ³ åˆ¶ä½œæ­¥éª¤</text>
          <button wx:if="{{isEditing}}" class="add-btn" bindtap="addStep">+</button>
        </view>
        <view class="steps-list">
          <view 
            wx:for="{{isEditing ? editRecipe.steps : currentRecipe.steps}}" 
            wx:key="*this" 
            class="step-item {{isEditing ? 'editing' : ''}}"
          >
            <view class="step-number">{{index + 1}}</view>
            <view wx:if="{{!isEditing}}" class="step-content-wrapper">
              <text class="step-content">{{item}}</text>
            </view>
            <view wx:else class="step-edit">
              <textarea 
                class="edit-input step-textarea"
                value="{{item}}"
                bindinput="onStepChange"
                data-index="{{index}}"
                placeholder="è¯·è¾“å…¥åˆ¶ä½œæ­¥éª¤"
                auto-height
              />
              <button 
                class="remove-btn"
                bindtap="removeStep"
                data-index="{{index}}"
              >Ã—</button>
            </view>
          </view>
        </view>
      </view>
      
      <!-- æ ‡ç­¾ -->
      <view class="tags-section">
        <text class="section-title">ğŸ·ï¸ æ ‡ç­¾</text>
        <view class="tags">
          <text 
            wx:for="{{currentRecipe.tags}}" 
            wx:key="*this" 
            class="tag tag-color-{{(index + 1) % 6 + 1}}"
          >
            {{item}}
          </text>
        </view>
      </view>
    </scroll-view>
    
    <!-- æ“ä½œæŒ‰é’® -->
    <view class="modal-footer">
      <view wx:if="{{!isEditing}}" class="action-buttons">
        <button class="action-btn upload-btn" bindtap="uploadFinishedImage">
          <text class="iconfont icon-camera"></text>
          <text>{{uploadingImage ? 'ä¸Šä¼ ä¸­...' : 'ä¸Šä¼ æˆå“å›¾'}}</text>
        </button>
        <button class="action-btn edit-btn" bindtap="startEditRecipe">
          <text class="iconfont icon-edit"></text>
          <text>ç¼–è¾‘</text>
        </button>
        <button class="action-btn delete-btn" bindtap="deleteRecipe">
          <text class="iconfont icon-delete"></text>
          <text>åˆ é™¤</text>
        </button>
      </view>
      
      <view wx:else class="edit-buttons">
        <button class="cancel-btn" bindtap="cancelEdit">å–æ¶ˆ</button>
        <button class="save-btn" bindtap="saveEdit">ä¿å­˜</button>
      </view>
    </view>
  </view>
</view>