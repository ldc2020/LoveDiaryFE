<!-- components/debug-panel/debug-panel.wxml -->
<view class="debug-panel-container">
  <!-- ÊÇ¨ÊµÆÊåâÈíÆ -->
  <view class="debug-btn" wx:if="{{showDebugBtn}}" bindtap="togglePanel">
    <text class="debug-icon">üîß</text>
  </view>
  
  <!-- Ë∞ÉËØïÈù¢Êùø -->
  <view class="debug-panel {{showPanel ? 'show' : ''}}" catchtap="closePanel">
    <view class="panel-content" catchtap="stopPropagation">
      <!-- Èù¢ÊùøÂ§¥ÈÉ® -->
      <view class="panel-header">
        <text class="panel-title">Ë∞ÉËØï‰ø°ÊÅØÈù¢Êùø</text>
        <view class="header-actions">
          <text class="refresh-btn" bindtap="refreshInfo">üîÑ</text>
          <text class="close-btn" bindtap="closePanel">√ó</text>
        </view>
      </view>
      
      <!-- Âä†ËΩΩÁä∂ÊÄÅ -->
      <view class="loading" wx:if="{{loading}}">
        <text>Âä†ËΩΩ‰∏≠...</text>
      </view>
      
      <!-- Èù¢ÊùøÂÜÖÂÆπ -->
      <view class="panel-body" wx:else>
        <!-- ÁºìÂ≠ò‰ø°ÊÅØÁªüËÆ° -->
        <view class="section">
          <view class="section-title" bindtap="toggleCacheSection">
            <text class="expand-icon">{{showCacheSection ? '‚ñº' : '‚ñ∂'}}</text>
            <text>ÁºìÂ≠ò‰ø°ÊÅØ (ÊÄªÂ§ßÂ∞è: {{totalCacheSizeText}}, Êñá‰ª∂Êï∞: {{totalCacheCount}})</text>
          </view>
          <scroll-view class="cache-list" scroll-y="true" wx:if="{{showCacheSection}}">
            <view class="cache-item" wx:for="{{cacheInfo}}" wx:key="key" bindtap="toggleCacheDetail" data-index="{{index}}">
              <view class="cache-header">
                <text class="cache-key">{{item.key}}</text>
                <text class="cache-type type-{{item.type}}">{{item.type}}</text>
                <text class="cache-size">{{item.size}} {{item.elementCount}}</text>
                <text class="expand-icon">{{item.showDetail ? '‚ñº' : '‚ñ∂'}}</text>
              </view>
              <view class="cache-detail" wx:if="{{item.showDetail}}">
                <text class="detail-label">ÂÄºÔºö</text>
                <text class="detail-value">{{item.value}}</text>
              </view>
            </view>
          </scroll-view>
        </view>
        
        <!-- Êñá‰ª∂ÁªüËÆ°‰ø°ÊÅØ -->
        <view class="section">
          <view class="section-title" bindtap="toggleFileSection">
            <text class="expand-icon">{{showFileSection ? '‚ñº' : '‚ñ∂'}}</text>
            <text>Êñá‰ª∂ÁªüËÆ°</text>
          </view>
          <scroll-view class="file-list" scroll-y="true" wx:if="{{showFileSection}}">
            <!-- Êñá‰ª∂Á±ªÂûãÈ°πÁõÆ -->
            <view class="file-item" wx:for="{{fileStats}}" wx:key="type">
              <view class="file-header" bindtap="toggleFileDetails" data-type="{{item.type}}">
                <view class="file-type">
                  <text class="expand-icon">{{item.expanded ? '‚ñº' : '‚ñ∂'}}</text>
                  <text class="file-type-name">{{item.type}}</text>
                </view>
                <view class="file-info">
                  <text class="file-count">{{item.count}}‰∏™</text>
                  <text class="file-size">{{item.size}}</text>
                </view>
              </view>
              
              <!-- Êñá‰ª∂ËØ¶ÊÉÖÂàóË°® -->
              <view class="file-details" wx:if="{{item.expanded && item.files && item.files.length > 0}}">
                <view class="detail-item" wx:for="{{item.files}}" wx:for-item="file" wx:key="filePath">
                  <view class="file-path clickable" catchtap="previewImage" data-src="{{file.filePath}}">
                    <text wx:if="{{item.type.indexOf('ÂõæÁâá') !== -1 || item.type.indexOf('image') !== -1}}">üì∑</text>
                    <text wx:else>üìÑ</text>
                    {{file.filePath}}
                  </view>
                  <view class="file-detail-info">
                    <text class="file-detail-size">{{file.sizeFormatted || file.size}}</text>
                    <text class="file-detail-time" wx:if="{{file.createTimeFormatted}}">{{file.createTimeFormatted}}</text>
                  </view>
                </view>
              </view>
            </view>
          </scroll-view>
        </view>
      </view>
    </view>
  </view>
</view>