<!-- components/debug-panel/debug-panel.wxml -->
<view class="debug-panel-container">
  <!-- æ‚¬æµ®æŒ‰é’® -->
  <view class="debug-btn" wx:if="{{showDebugBtn}}" bindtap="togglePanel">
    <text class="debug-icon">ğŸ”§</text>
  </view>
  
  <!-- è°ƒè¯•é¢æ¿ -->
  <view class="debug-panel {{showPanel ? 'show' : ''}}" catchtap="closePanel">
    <view class="panel-content" catchtap="stopPropagation">
      <!-- é¢æ¿å¤´éƒ¨ -->
      <view class="panel-header">
        <text class="panel-title">è°ƒè¯•ä¿¡æ¯é¢æ¿</text>
        <view class="header-actions">
          <text class="init-db-btn" bindtap="initDatabase">ğŸ—„ï¸</text>
          <text class="perm-btn" bindtap="setCollectionPermission">ğŸ”‘</text>
          <text class="refresh-btn" bindtap="refreshInfo">ğŸ”„</text>
          <text class="close-btn" bindtap="closePanel">Ã—</text>
        </view>
      </view>
      
      <!-- åŠ è½½çŠ¶æ€ -->
      <view class="loading" wx:if="{{loading}}">
        <text>åŠ è½½ä¸­...</text>
      </view>
      
      <!-- é¢æ¿å†…å®¹ -->
      <view class="panel-body" wx:else>
        <!-- ç¼“å­˜ä¿¡æ¯ç»Ÿè®¡ -->
        <view class="section">
          <view class="section-title" bindtap="toggleCacheSection">
            <text class="expand-icon">{{showCacheSection ? 'â–¼' : 'â–¶'}}</text>
            <text>ç¼“å­˜ä¿¡æ¯ (æ€»å¤§å°: {{totalCacheSizeText}}, æ–‡ä»¶æ•°: {{totalCacheCount}})</text>
          </view>
          
          <!-- ç¼“å­˜æœç´¢æ¡† -->
          <view class="cache-search-container" wx:if="{{showCacheSection}}">
            <view class="search-input-wrapper">
              <input 
                class="cache-search-input" 
                placeholder="è¾“å…¥ç¼“å­˜keyå‰ç¼€è¿›è¡Œæœç´¢..." 
                value="{{cacheSearchKeyword}}"
                bindinput="onCacheSearchInput"
                placeholder-class="search-placeholder"
              />
              <text class="clear-search-btn" wx:if="{{cacheSearchKeyword}}" bindtap="clearCacheSearch">Ã—</text>
            </view>
            <view class="search-result-info" wx:if="{{cacheSearchKeyword}}">
              <text class="result-count">æ‰¾åˆ° {{filteredCacheCount}} / {{totalCacheCount}} ä¸ªç¼“å­˜</text>
            </view>
          </view>
          
          <scroll-view class="cache-list" scroll-y="true" wx:if="{{showCacheSection}}">
            <view class="cache-item" wx:for="{{filteredCacheInfo}}" wx:key="key" bindtap="toggleCacheDetail" data-index="{{index}}">
              <view class="cache-header">
                <text class="cache-key">{{item.key}}</text>
                <text class="cache-type type-{{item.type}}">{{item.type}}</text>
                <text class="cache-size">{{item.size}} {{item.elementCount}}</text>
                <text class="expand-icon">{{item.showDetail ? 'â–¼' : 'â–¶'}}</text>
              </view>
              <view class="cache-detail" wx:if="{{item.showDetail}}">
                <text class="detail-label">å€¼ï¼š</text>
                <text class="detail-value">{{item.value}}</text>
              </view>
            </view>
            
            <!-- æ— æœç´¢ç»“æœæç¤º -->
            <view class="no-results" wx:if="{{cacheSearchKeyword && filteredCacheCount === 0}}">
              <text class="no-results-text">æœªæ‰¾åˆ°åŒ¹é… "{{cacheSearchKeyword}}" çš„ç¼“å­˜</text>
              <text class="no-results-tip">è¯·å°è¯•å…¶ä»–å…³é”®è¯æˆ–æ¸…ç©ºæœç´¢</text>
            </view>
          </scroll-view>
        </view>
        
        <!-- æ–‡ä»¶ç»Ÿè®¡ä¿¡æ¯ -->
        <view class="section">
          <view class="section-title" bindtap="toggleFileSection">
            <text class="expand-icon">{{showFileSection ? 'â–¼' : 'â–¶'}}</text>
            <text>æ–‡ä»¶ç»Ÿè®¡</text>
          </view>
          <scroll-view class="file-list" scroll-y="true" wx:if="{{showFileSection}}">
            <!-- æ–‡ä»¶ç±»å‹é¡¹ç›® -->
            <view class="file-item" wx:for="{{fileStats}}" wx:key="type">
              <view class="file-header" bindtap="toggleFileDetails" data-type="{{item.type}}">
                <view class="file-type">
                  <text class="expand-icon">{{item.expanded ? 'â–¼' : 'â–¶'}}</text>
                  <text class="file-type-name">{{item.type}}</text>
                </view>
                <view class="file-info">
                  <text class="file-count">{{item.count}}ä¸ª</text>
                  <text class="file-size">{{item.size}}</text>
                </view>
              </view>
              
              <!-- æ–‡ä»¶è¯¦æƒ…åˆ—è¡¨ -->
              <view class="file-details" wx:if="{{item.expanded && item.files && item.files.length > 0}}">
                <view class="detail-item" wx:for="{{item.files}}" wx:for-item="file" wx:key="filePath">
                  <view class="file-path clickable" catchtap="previewImage" data-src="{{file.filePath}}">
                    <text wx:if="{{item.type.indexOf('å›¾ç‰‡') !== -1 || item.type.indexOf('image') !== -1}}">ğŸ“·</text>
                    <text wx:else>ğŸ“„</text>
                    {{file.filePath}}
                  </view>
                  <view class="file-detail-info">
                    <text class="file-detail-size">{{file.sizeFormatted || file.size}}</text>
                    <text class="file-detail-time" wx:if="{{file.createTimeFormatted}}">{{file.createTimeFormatted}}</text>
                  </view>
                </view>
              </view>
            </view>
          </scroll-view>
        </view>
      </view>
    </view>
  </view>
</view>